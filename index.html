<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Food List & Meal Builder</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<style>
:root{
  --bg:#ffffff; --muted:#6b7280; --border:#e6e9ee; --card:#f9fafb;
  --accent:#2563eb; --accent-600:#1e40af; --danger:#ef4444;
  --shadow:0 6px 18px rgba(32,33,36,0.06);
}

body{
  font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;
  margin:20px;
  background:var(--bg);
  color:#111827;
  max-width:1600px;
}

h1,h2{margin:0 0 12px}

.grid{
  display:grid;
  grid-template-columns:1fr 720px;
  gap:20px;
}

@media(max-width:1100px){
  .grid{grid-template-columns:1fr}
}

.box{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:14px;
  box-shadow:var(--shadow);
}

.flex{display:flex;gap:12px;flex-wrap:wrap}
.column{display:flex;flex-direction:column;gap:6px}

input,button{
  padding:8px 10px;
  border-radius:8px;
  border:1px solid var(--border);
  font-size:1rem;
}

input:focus{border-color:var(--accent)}

.btn{cursor:pointer;font-weight:600}
.btn-primary{background:linear-gradient(180deg,var(--accent),var(--accent-600));color:#fff;border:none}
.btn-secondary{background:#fff}
.btn-danger{background:linear-gradient(180deg,var(--danger),#b91c1c);color:#fff;border:none}
.btn-sm{font-size:.85rem;padding:6px 8px}

table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #eee}

.table-wrap{overflow-x:auto}

.meal-grams{
  width:80px;
  text-align:center;
}

/* ===== MOBILE CARD LAYOUT ===== */
@media(max-width:640px){
  body{margin:12px}

  #mealTable thead,
  #mealTable tfoot{display:none}

  #mealTable,
  #mealTable tbody,
  #mealTable tr,
  #mealTable td{display:block;width:100%}

  #mealTable tr{
    background:#fff;
    border:1px solid var(--border);
    border-radius:12px;
    padding:12px;
    margin-bottom:12px;
    box-shadow:var(--shadow);
  }

  #mealTable td{
    border:none;
    padding:4px 0;
  }

  #mealTable td::before{
    content:attr(data-label);
    display:block;
    font-size:.75rem;
    color:var(--muted);
    margin-bottom:2px;
  }

  .meal-grams{
    width:100%;
    padding:10px;
    font-size:1rem;
  }

  .meal-totals-mobile{
    position:sticky;
    bottom:0;
    background:#fff;
    padding:10px;
    border-top:1px solid var(--border);
    display:flex;
    justify-content:space-between;
    font-weight:700;
  }
}
</style>
</head>

<body>

<h1>Food List & Meal Builder</h1>

<div class="grid">

<!-- LEFT -->
<div>

<div class="box">
<h2>Add Food</h2>
<div class="flex">
  <label class="column">Name
    <input id="foodName" type="text">
  </label>

  <label class="column">Serving (g)
    <input id="servingGrams" type="text" inputmode="decimal" pattern="[0-9]*">
  </label>

  <label class="column">Carbs (g)
    <input id="carbs" type="text" inputmode="decimal" pattern="[0-9]*">
  </label>

  <label class="column">Protein (g)
    <input id="protein" type="text" inputmode="decimal" pattern="[0-9]*">
  </label>

  <button id="addFoodBtn" class="btn btn-primary">Add Food</button>
</div>
</div>

<div class="box">
<h2>Saved Foods</h2>

<input id="searchFood" type="search" placeholder="Search foods..." style="margin-bottom:10px;width:100%">

<table id="foodsTable">
<thead>
<tr>
  <th>Name</th>
  <th>Serving (g)</th>
  <th>Carbs (g)</th>
  <th>Protein (g)</th>
  <th></th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

</div>

<!-- RIGHT -->
<div>

<div class="box">
<h2>Meal Builder</h2>

<div class="table-wrap">
<table id="mealTable">
<thead>
<tr>
<th>Food</th><th>Serving</th><th>Consumed</th><th>Carbs</th><th>Protein</th><th></th>
</tr>
</thead>
<tbody></tbody>
<tfoot>
<tr>
<td><strong>Totals</strong></td>
<td></td><td></td>
<td id="totalCarbsDesktop">0</td>
<td id="totalProteinDesktop">0</td>
<td></td>
</tr>
</tfoot>
</table>
</div>

<div class="meal-totals-mobile">
<div>Carbs: <span id="totalCarbsMobile">0</span> g</div>
<div>Protein: <span id="totalProteinMobile">0</span> g</div>
</div>

<button id="clearMeal" class="btn btn-secondary">Clear Meal</button>
</div>

</div>
</div>

<script>
const STORAGE_KEY="foods";
let foods=JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");
let meal=[];
let searchQuery="";

const foodsBody=document.querySelector("#foodsTable tbody");
const mealBody=document.querySelector("#mealTable tbody");

const totalCarbsDesktop=document.getElementById("totalCarbsDesktop");
const totalProteinDesktop=document.getElementById("totalProteinDesktop");
const totalCarbsMobile=document.getElementById("totalCarbsMobile");
const totalProteinMobile=document.getElementById("totalProteinMobile");

function saveFoods(){
  localStorage.setItem(STORAGE_KEY,JSON.stringify(foods));
}

function renderFoods(){
  foodsBody.innerHTML="";
  foods
    .filter(f=>f.name.toLowerCase().includes(searchQuery))
    .forEach(f=>{
      foodsBody.insertAdjacentHTML("beforeend",`
        <tr>
          <td>${f.name}</td>
          <td>${f.servingGrams}</td>
          <td>${f.carbs}</td>
          <td>${f.protein}</td>
          <td style="white-space:nowrap">
            <button class="btn btn-primary btn-sm" data-add="${f.id}">Add</button>
            <button class="btn btn-danger btn-sm" data-del="${f.id}">Delete</button>
          </td>
        </tr>
      `);
    });
}

function renderMeal(){
  mealBody.innerHTML="";
  meal.forEach((f,i)=>{
    mealBody.insertAdjacentHTML("beforeend",`
      <tr>
        <td data-label="Food">${f.name}</td>
        <td data-label="Serving">${f.servingGrams}</td>
        <td data-label="Consumed">
          <input class="meal-grams"
            type="text"
            inputmode="numeric"
            pattern="[0-9]*"
            value="${f.consumed}"
            data-i="${i}">
        </td>
        <td data-label="Carbs" class="carbs" data-i="${i}">0</td>
        <td data-label="Protein" class="protein" data-i="${i}">0</td>
        <td><button class="btn btn-danger btn-sm" data-r="${i}">Remove</button></td>
      </tr>
    `);
  });
  recalcTotals();
}

function recalcTotals(){
  let tc=0,tp=0;
  meal.forEach((f,i)=>{
    const ratio=(f.consumed||0)/(f.servingGrams||1);
    const c=f.carbs*ratio;
    const p=f.protein*ratio;
    tc+=c; tp+=p;

    document.querySelector(`.carbs[data-i="${i}"]`).textContent=c.toFixed(2);
    document.querySelector(`.protein[data-i="${i}"]`).textContent=p.toFixed(2);
  });

  totalCarbsDesktop.textContent=tc.toFixed(2);
  totalProteinDesktop.textContent=tp.toFixed(2);
  totalCarbsMobile.textContent=tc.toFixed(2);
  totalProteinMobile.textContent=tp.toFixed(2);
}

addFoodBtn.onclick=()=>{
  if(!foodName.value.trim())return;
  foods.push({
    id:Date.now(),
    name:foodName.value.trim(),
    servingGrams:+servingGrams.value||0,
    carbs:+carbs.value||0,
    protein:+protein.value||0
  });
  saveFoods();
  renderFoods();
  foodName.value=servingGrams.value=carbs.value=protein.value="";
};

document.addEventListener("click",e=>{
  if(e.target.dataset.add){
    const f=foods.find(x=>x.id==e.target.dataset.add);
    meal.push({...f,consumed:f.servingGrams});
    renderMeal();
  }
  if(e.target.dataset.del){
    if(confirm("Delete this food?")){
      const id=e.target.dataset.del;
      foods=foods.filter(f=>f.id!=id);
      meal=meal.filter(m=>m.id!=id);
      saveFoods();
      renderFoods();
      renderMeal();
    }
  }
  if(e.target.dataset.r){
    meal.splice(e.target.dataset.r,1);
    renderMeal();
  }
});

document.addEventListener("input",e=>{
  if(e.target.classList.contains("meal-grams")){
    const i=e.target.dataset.i;
    const v=e.target.value.replace(/\D/g,"");
    e.target.value=v;
    meal[i].consumed=Number(v)||0;
    recalcTotals();
  }
});

searchFood.addEventListener("input",e=>{
  searchQuery=e.target.value.toLowerCase();
  renderFoods();
});

clearMeal.onclick=()=>{
  if(confirm("Clear meal?")){
    meal=[];
    renderMeal();
  }
};

renderFoods();
</script>

</body>
</html>
